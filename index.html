<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>Stock Icons JSON Generator</title>
    <style>
        * { box-sizing: border-box; }
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            max-width: 800px; margin: 50px auto; padding: 20px;
            background: #1a1a2e; color: #eee;
        }
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        h1 { color: #4fc3f7; margin: 0; }
        .version { color: #888; font-size: 0.9rem; }
        .lang-select { 
            background: #16213e; color: #fff; border: 1px solid #4fc3f7;
            padding: 5px 10px; border-radius: 6px; cursor: pointer;
        }
        .drop-zone {
            border: 3px dashed #4fc3f7; border-radius: 12px;
            padding: 40px; text-align: center; margin: 20px 0;
            background: #16213e; cursor: pointer;
            transition: all 0.3s;
        }
        .drop-zone:hover, .drop-zone.drag-over {
            background: #1a3a5c; border-color: #81d4fa;
        }
        .drop-zone input { display: none; }
        .category-section { 
            background: #16213e; border-radius: 8px; 
            padding: 15px; margin: 10px 0;
        }
        .category-title { 
            color: #4fc3f7; font-weight: bold; 
            margin-bottom: 10px; font-size: 1.1rem;
        }
        .icon-list { 
            display: flex; flex-wrap: wrap; gap: 8px;
        }
        .icon-item {
            background: #0f3460; padding: 8px 12px; border-radius: 6px;
            font-size: 0.85rem; display: flex; align-items: center; gap: 8px;
        }
        .icon-item svg { width: 20px; height: 20px; fill: #fff; }
        .icon-item .edit-btn {
            background: #4fc3f7; color: #000; border: none;
            padding: 2px 6px; border-radius: 3px; cursor: pointer;
            font-size: 0.7rem;
        }
        button.primary {
            background: #4fc3f7; color: #000; border: none;
            padding: 15px 30px; font-size: 1.1rem; border-radius: 8px;
            cursor: pointer; margin: 20px 0; font-weight: bold;
        }
        button.primary:hover { background: #81d4fa; }
        button.primary:disabled { background: #666; cursor: not-allowed; }
        .instructions { 
            background: #0f3460; padding: 20px; border-radius: 8px;
            margin: 20px 0; line-height: 1.8;
        }
        .instructions h3 { color: #4fc3f7; margin-top: 0; }
        .instructions code { 
            background: #1a1a2e; padding: 2px 6px; border-radius: 4px;
        }
        .count { color: #4fc3f7; font-weight: bold; }
        .modal {
            display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.8); justify-content: center; align-items: center;
            z-index: 100;
        }
        .modal.show { display: flex; }
        .modal-content {
            background: #16213e; padding: 30px; border-radius: 12px;
            max-width: 400px; width: 90%;
        }
        .modal input, .modal select {
            width: 100%; padding: 10px; margin: 10px 0;
            background: #0f3460; border: 1px solid #4fc3f7;
            color: #fff; border-radius: 6px;
        }
        .modal-buttons { display: flex; gap: 10px; margin-top: 15px; }
        .modal-buttons button { flex: 1; padding: 10px; border-radius: 6px; cursor: pointer; }
        .btn-cancel { background: #666; color: #fff; border: none; }
        .btn-save { background: #4fc3f7; color: #000; border: none; }
        .category-select-row { margin: 15px 0; }
        .category-select-row select {
            background: #16213e; color: #fff; border: 1px solid #4fc3f7;
            padding: 8px 12px; border-radius: 6px;
        }
    </style>
</head>
<body>
    <div class="header">
        <div>
            <h1>ğŸ“ Stock Icons JSON Generator</h1>
            <span class="version">v1.0</span>
        </div>
        <select class="lang-select" id="langSelect">
            <option value="ja">æ—¥æœ¬èª</option>
            <option value="en">English</option>
        </select>
    </div>
    
    <div class="instructions" id="instructions">
        <!-- Content will be set by JS -->
    </div>

    <!-- Step 1: Load existing JSON -->
    <div class="drop-zone" id="jsonDropZone" style="border-color: #ffa726; margin-bottom: 10px;">
        <p style="font-size: 1.2rem; margin: 0;" data-i18n="drop_json_title">ğŸ“„ â‘  æ—¢å­˜ã® icons.json ã‚’ã“ã“ã«ãƒ‰ãƒ­ãƒƒãƒ—</p>
        <p style="color: #888; margin: 10px 0 0;" data-i18n="drop_json_desc">æ—¢å­˜ã‚¢ã‚¤ã‚³ãƒ³ã‚’ä¿æŒã—ãŸã¾ã¾è¿½åŠ ã§ãã¾ã™</p>
        <input type="file" id="jsonInput" accept=".json">
    </div>
    <div id="jsonStatus" style="text-align: center; margin-bottom: 15px; color: #ffa726;"></div>

    <!-- Step 2: Add SVG files -->
    <div class="drop-zone" id="dropZone">
        <p style="font-size: 1.2rem; margin: 0;" data-i18n="drop_svg_title">ğŸ“‚ â‘¡ SVGãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã“ã“ã«ãƒ‰ãƒ©ãƒƒã‚°ï¼†ãƒ‰ãƒ­ãƒƒãƒ—</p>
        <p style="color: #888; margin: 10px 0 0;" data-i18n="drop_svg_desc">ã¾ãŸã¯ ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠ</p>
        <input type="file" id="fileInput" multiple accept=".svg">
    </div>

    <div class="category-select-row">
        <label data-i18n="lbl_category">è¿½åŠ å…ˆã‚«ãƒ†ã‚´ãƒª: </label>
        <select id="categorySelect">
            <option value="auto" data-i18n="cat_auto">è‡ªå‹•åˆ¤åˆ¥</option>
            <option value="arrows" data-i18n="cat_arrows">çŸ¢å° (arrows)</option>
            <option value="media" data-i18n="cat_media">ãƒ¡ãƒ‡ã‚£ã‚¢ (media)</option>
            <option value="modifiers" data-i18n="cat_modifiers">ä¿®é£¾ã‚­ãƒ¼ (modifiers)</option>
            <option value="system" data-i18n="cat_system">ã‚·ã‚¹ãƒ†ãƒ  (system)</option>
            <option value="symbols" data-i18n="cat_symbols">è¨˜å· (symbols)</option>
        </select>
    </div>

    <div id="iconsList"></div>

    <button class="primary" id="generateBtn" disabled data-i18n="btn_generate">icons.json ã‚’ç”Ÿæˆãƒ»ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</button>

    <!-- Edit Modal -->
    <div class="modal" id="editModal">
        <div class="modal-content">
            <h3 data-i18n="modal_title">ã‚¢ã‚¤ã‚³ãƒ³æƒ…å ±ã‚’ç·¨é›†</h3>
            <label>ID:</label>
            <input type="text" id="editId">
            <label data-i18n="lbl_name_en">è‹±èªå:</label>
            <input type="text" id="editName">
            <label data-i18n="lbl_name_ja">æ—¥æœ¬èªå:</label>
            <input type="text" id="editNameJa">
            <label data-i18n="lbl_category">ã‚«ãƒ†ã‚´ãƒª:</label>
            <select id="editCategory">
                <option value="arrows">çŸ¢å° (arrows)</option>
                <option value="media">ãƒ¡ãƒ‡ã‚£ã‚¢ (media)</option>
                <option value="modifiers">ä¿®é£¾ã‚­ãƒ¼ (modifiers)</option>
                <option value="system">ã‚·ã‚¹ãƒ†ãƒ  (system)</option>
                <option value="symbols">è¨˜å· (symbols)</option>
            </select>
            <div class="modal-buttons">
                <button class="btn-cancel" onclick="closeModal()" data-i18n="btn_cancel">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
                <button class="btn-save" onclick="saveEdit()" data-i18n="btn_save">ä¿å­˜</button>
            </div>
        </div>
    </div>

    <script>
        // ========== Internationalization ==========
        const i18n = {
            ja: {
                instructions_title: 'ä½¿ã„æ–¹',
                instructions_html: `
                    <h3>ä½¿ã„æ–¹</h3>
                    <ol>
                        <li><strong>ã¾ãšæ—¢å­˜ã® icons.json ã‚’ãƒ‰ãƒ­ãƒƒãƒ—</strong>ï¼ˆæ—¢å­˜ã‚¢ã‚¤ã‚³ãƒ³ã‚’èª­ã¿è¾¼ã¿ï¼‰</li>
                        <li>è¿½åŠ ã—ãŸã„SVGãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ‰ãƒ­ãƒƒãƒ—</li>
                        <li>ã€Œicons.json ã‚’ç”Ÿæˆã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯</li>
                        <li>ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã•ã‚ŒãŸ <code>icons.json</code> ã‚’ <code>stock-icons/</code> ãƒ•ã‚©ãƒ«ãƒ€ã«ä¸Šæ›¸ãä¿å­˜</li>
                    </ol>
                `,
                drop_json_title: 'ğŸ“„ â‘  æ—¢å­˜ã® icons.json ã‚’ã“ã“ã«ãƒ‰ãƒ­ãƒƒãƒ—',
                drop_json_desc: 'æ—¢å­˜ã‚¢ã‚¤ã‚³ãƒ³ã‚’ä¿æŒã—ãŸã¾ã¾è¿½åŠ ã§ãã¾ã™',
                drop_svg_title: 'ğŸ“‚ â‘¡ SVGãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã“ã“ã«ãƒ‰ãƒ©ãƒƒã‚°ï¼†ãƒ‰ãƒ­ãƒƒãƒ—',
                drop_svg_desc: 'ã¾ãŸã¯ ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠ',
                lbl_category: 'è¿½åŠ å…ˆã‚«ãƒ†ã‚´ãƒª:',
                cat_auto: 'è‡ªå‹•åˆ¤åˆ¥',
                cat_arrows: 'çŸ¢å° (arrows)',
                cat_media: 'ãƒ¡ãƒ‡ã‚£ã‚¢ (media)',
                cat_modifiers: 'ä¿®é£¾ã‚­ãƒ¼ (modifiers)',
                cat_system: 'ã‚·ã‚¹ãƒ†ãƒ  (system)',
                cat_symbols: 'è¨˜å· (symbols)',
                btn_generate: 'icons.json ã‚’ç”Ÿæˆãƒ»ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰',
                modal_title: 'ã‚¢ã‚¤ã‚³ãƒ³æƒ…å ±ã‚’ç·¨é›†',
                lbl_name_en: 'è‹±èªå:',
                lbl_name_ja: 'æ—¥æœ¬èªå:',
                btn_cancel: 'ã‚­ãƒ£ãƒ³ã‚»ãƒ«',
                btn_save: 'ä¿å­˜',
                btn_edit: 'ç·¨é›†',
                json_loaded: 'âœ… %count%å€‹ã®æ—¢å­˜ã‚¢ã‚¤ã‚³ãƒ³ã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸ',
                total: 'åˆè¨ˆ',
                existing: 'æ—¢å­˜',
                new_icon: 'æ–°è¦',
                updated: 'æ›´æ–°',
                no_icons: 'ã¾ã ã‚¢ã‚¤ã‚³ãƒ³ãŒã‚ã‚Šã¾ã›ã‚“ã€‚ã¾ãš icons.json ã‚’ãƒ‰ãƒ­ãƒƒãƒ—ã—ã¦ãã ã•ã„ã€‚',
                alert_generated: 'âœ… icons.json ã‚’ç”Ÿæˆã—ã¾ã—ãŸï¼ï¼ˆ%count%å€‹ã®ã‚¢ã‚¤ã‚³ãƒ³ï¼‰\n\nã€æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—ã€‘\n1. ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã•ã‚ŒãŸ icons.json ã‚’ stock-icons/ ãƒ•ã‚©ãƒ«ãƒ€ã«ä¸Šæ›¸ãä¿å­˜\n2. æ–°ã—ã„SVGãƒ•ã‚¡ã‚¤ãƒ«ã‚‚å¯¾å¿œã™ã‚‹ã‚«ãƒ†ã‚´ãƒªãƒ•ã‚©ãƒ«ãƒ€ã«ä¿å­˜\n\nâ€» ãƒ–ãƒ©ã‚¦ã‚¶ã‚’ãƒªãƒ­ãƒ¼ãƒ‰ã—ã¦åæ˜ ã‚’ç¢ºèªã—ã¦ãã ã•ã„'
            },
            en: {
                instructions_title: 'How to Use',
                instructions_html: `
                    <h3>How to Use</h3>
                    <ol>
                        <li><strong>First, drop the existing icons.json</strong> (load existing icons)</li>
                        <li>Drop SVG files you want to add</li>
                        <li>Click "Generate icons.json" button</li>
                        <li>Save the downloaded <code>icons.json</code> to <code>stock-icons/</code> folder</li>
                    </ol>
                `,
                drop_json_title: 'ğŸ“„ â‘  Drop existing icons.json here',
                drop_json_desc: 'Keep existing icons while adding new ones',
                drop_svg_title: 'ğŸ“‚ â‘¡ Drag & drop SVG files here',
                drop_svg_desc: 'or click to select files',
                lbl_category: 'Target Category:',
                cat_auto: 'Auto-detect',
                cat_arrows: 'Arrows',
                cat_media: 'Media',
                cat_modifiers: 'Modifiers',
                cat_system: 'System',
                cat_symbols: 'Symbols',
                btn_generate: 'Generate & Download icons.json',
                modal_title: 'Edit Icon Info',
                lbl_name_en: 'English Name:',
                lbl_name_ja: 'Japanese Name:',
                btn_cancel: 'Cancel',
                btn_save: 'Save',
                btn_edit: 'Edit',
                json_loaded: 'âœ… Loaded %count% existing icons',
                total: 'Total',
                existing: 'Existing',
                new_icon: 'New',
                updated: 'Updated',
                no_icons: 'No icons yet. Please drop icons.json first.',
                alert_generated: 'âœ… Generated icons.json! (%count% icons)\n\nã€Next Stepsã€‘\n1. Save downloaded icons.json to stock-icons/ folder\n2. Also save new SVG files to corresponding category folders\n\nâ€» Reload browser to see changes'
            }
        };

        let currentLang = 'ja';

        function t(key) {
            return i18n[currentLang][key] || key;
        }

        function updateLanguage() {
            currentLang = document.getElementById('langSelect').value;
            
            // Update instructions
            document.getElementById('instructions').innerHTML = t('instructions_html');
            
            // Update all elements with data-i18n
            document.querySelectorAll('[data-i18n]').forEach(el => {
                const key = el.getAttribute('data-i18n');
                if (el.tagName === 'OPTION') {
                    el.textContent = t(key);
                } else if (el.tagName === 'INPUT' || el.tagName === 'BUTTON') {
                    if (el.value) el.value = t(key);
                    else el.textContent = t(key);
                } else {
                    el.textContent = t(key);
                }
            });
            
            // Re-render icons with new language
            renderIcons();
        }

        document.getElementById('langSelect').addEventListener('change', updateLanguage);

        // ========== Main Logic ==========
        const CATEGORIES = [
            { id: 'arrows', name: 'Arrows', nameJa: 'çŸ¢å°' },
            { id: 'media', name: 'Media', nameJa: 'ãƒ¡ãƒ‡ã‚£ã‚¢' },
            { id: 'modifiers', name: 'Modifiers', nameJa: 'ä¿®é£¾ã‚­ãƒ¼' },
            { id: 'system', name: 'System', nameJa: 'ã‚·ã‚¹ãƒ†ãƒ ' },
            { id: 'symbols', name: 'Symbols', nameJa: 'è¨˜å·' }
        ];

        const NAME_MAP = {
            'up': 'ä¸ŠçŸ¢å°', 'down': 'ä¸‹çŸ¢å°', 'left': 'å·¦çŸ¢å°', 'right': 'å³çŸ¢å°',
            'arrow': 'çŸ¢å°', 'share': 'ã‚·ã‚§ã‚¢', 'download': 'ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰', 'upload': 'ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰',
            'recycle': 'ãƒªã‚µã‚¤ã‚¯ãƒ«', 'reply': 'è¿”ä¿¡', 'uturn': 'Uã‚¿ãƒ¼ãƒ³', 'chart': 'ã‚°ãƒ©ãƒ•',
            'play': 'å†ç”Ÿ', 'pause': 'ä¸€æ™‚åœæ­¢', 'stop': 'åœæ­¢', 'volume': 'éŸ³é‡', 'mute': 'ãƒŸãƒ¥ãƒ¼ãƒˆ',
            'skip': 'ã‚¹ã‚­ãƒƒãƒ—', 'forward': 'æ¬¡ã¸', 'back': 'å‰ã¸',
            'command': 'Command', 'shift': 'Shift', 'ctrl': 'Ctrl', 'alt': 'Alt', 'option': 'Option',
            'enter': 'Enter', 'tab': 'Tab', 'escape': 'Esc', 'backspace': 'Backspace', 'esc': 'Esc',
            'capslock': 'CapsLock', 'fn': 'Fn', 'windows': 'Windows',
            'power': 'é›»æº', 'home': 'ãƒ›ãƒ¼ãƒ ', 'gear': 'è¨­å®š', 'settings': 'è¨­å®š',
            'brightness': 'æ˜ã‚‹ã•', 'camera': 'ã‚«ãƒ¡ãƒ©', 'lock': 'ãƒ­ãƒƒã‚¯',
            'wifi': 'WiFi', 'bluetooth': 'Bluetooth', 'search': 'æ¤œç´¢',
            'delete': 'å‰Šé™¤', 'refresh': 'æ›´æ–°', 'menu': 'ãƒ¡ãƒ‹ãƒ¥ãƒ¼',
            'star': 'æ˜Ÿ', 'heart': 'ãƒãƒ¼ãƒˆ', 'check': 'ãƒã‚§ãƒƒã‚¯', 'close': 'é–‰ã˜ã‚‹',
            'plus': 'ãƒ—ãƒ©ã‚¹', 'minus': 'ãƒã‚¤ãƒŠã‚¹', 'smile': 'ã‚¹ãƒã‚¤ãƒ«',
            'gamepad': 'ã‚²ãƒ¼ãƒ ãƒ‘ãƒƒãƒ‰', 'lightning': 'ç¨²å¦»', 'fire': 'ç‚',
            'skull': 'ãƒ‰ã‚¯ãƒ­', 'music': 'éŸ³æ¥½', 'circle': 'ä¸¸', 'bold': 'å¤ª', 'detail': 'è©³ç´°'
        };

        const CATEGORY_KEYWORDS = {
            arrows: ['arrow', 'up', 'down', 'left', 'right', 'share', 'download', 'upload', 'recycle', 'reply', 'uturn', 'chart'],
            media: ['play', 'pause', 'stop', 'volume', 'mute', 'skip', 'forward', 'back', 'music', 'audio', 'video'],
            modifiers: ['command', 'shift', 'ctrl', 'alt', 'option', 'enter', 'tab', 'escape', 'backspace', 'caps', 'fn', 'windows', 'meta', 'super'],
            system: ['power', 'home', 'gear', 'settings', 'brightness', 'camera', 'lock', 'wifi', 'bluetooth', 'search', 'delete', 'refresh', 'menu'],
            symbols: ['star', 'heart', 'check', 'close', 'plus', 'minus', 'smile', 'gamepad', 'lightning', 'fire', 'skull', 'music']
        };

        let icons = [];
        let editingIndex = -1;

        const jsonDropZone = document.getElementById('jsonDropZone');
        const jsonInput = document.getElementById('jsonInput');
        const jsonStatus = document.getElementById('jsonStatus');
        const dropZone = document.getElementById('dropZone');
        const fileInput = document.getElementById('fileInput');
        const categorySelect = document.getElementById('categorySelect');
        const iconsList = document.getElementById('iconsList');
        const generateBtn = document.getElementById('generateBtn');

        // JSON drop zone events
        jsonDropZone.addEventListener('click', () => jsonInput.click());
        jsonDropZone.addEventListener('dragover', (e) => { e.preventDefault(); jsonDropZone.classList.add('drag-over'); });
        jsonDropZone.addEventListener('dragleave', () => jsonDropZone.classList.remove('drag-over'));
        jsonDropZone.addEventListener('drop', (e) => {
            e.preventDefault();
            jsonDropZone.classList.remove('drag-over');
            loadExistingJson(e.dataTransfer.files);
        });
        jsonInput.addEventListener('change', (e) => loadExistingJson(e.target.files));

        // SVG drop zone events
        dropZone.addEventListener('click', () => fileInput.click());
        dropZone.addEventListener('dragover', (e) => { e.preventDefault(); dropZone.classList.add('drag-over'); });
        dropZone.addEventListener('dragleave', () => dropZone.classList.remove('drag-over'));
        dropZone.addEventListener('drop', (e) => {
            e.preventDefault();
            dropZone.classList.remove('drag-over');
            handleFiles(e.dataTransfer.files);
        });
        fileInput.addEventListener('change', (e) => handleFiles(e.target.files));

        function loadExistingJson(files) {
            const file = files[0];
            if (!file || !file.name.endsWith('.json')) return;
            
            const reader = new FileReader();
            reader.onload = (e) => {
                try {
                    const data = JSON.parse(e.target.result);
                    if (data.icons && Array.isArray(data.icons)) {
                        icons = data.icons.map(icon => ({
                            ...icon,
                            isExisting: true,
                            svgContent: null
                        }));
                        jsonStatus.textContent = t('json_loaded').replace('%count%', icons.length);
                        jsonStatus.style.color = '#4caf50';
                        renderIcons();
                        generateBtn.disabled = false;
                    }
                } catch (err) {
                    jsonStatus.textContent = 'âŒ JSON parse error: ' + err.message;
                    jsonStatus.style.color = '#f44';
                }
            };
            reader.readAsText(file);
        }

        function handleFiles(files) {
            const selectedCategory = categorySelect.value;
            
            Array.from(files).forEach(file => {
                if (!file.name.endsWith('.svg')) return;
                
                const reader = new FileReader();
                reader.onload = (e) => {
                    const svgContent = e.target.result;
                    const id = file.name.replace('.svg', '').toLowerCase().replace(/[^a-z0-9-]/g, '-');
                    
                    const existingIdx = icons.findIndex(icon => icon.id === id);
                    if (existingIdx !== -1) {
                        icons[existingIdx].svgContent = svgContent;
                        icons[existingIdx].isExisting = false;
                        icons[existingIdx].isUpdated = true;
                    } else {
                        const name = fileNameToTitle(file.name);
                        const nameJa = fileNameToJapanese(file.name);
                        const category = selectedCategory === 'auto' ? guessCategory(id) : selectedCategory;
                        
                        icons.push({
                            id, name, nameJa, category,
                            file: `${category}/${file.name}`,
                            svgContent,
                            isExisting: false,
                            isNew: true
                        });
                    }
                    
                    renderIcons();
                    generateBtn.disabled = false;
                };
                reader.readAsText(file);
            });
        }

        function fileNameToTitle(filename) {
            return filename.replace('.svg', '').split(/[-_]/).map(w => 
                w.charAt(0).toUpperCase() + w.slice(1)
            ).join(' ');
        }

        function fileNameToJapanese(filename) {
            const name = filename.replace('.svg', '').toLowerCase();
            const parts = name.split(/[-_]/);
            let ja = parts.map(p => NAME_MAP[p] || '').filter(Boolean).join('');
            return ja || fileNameToTitle(filename);
        }

        function guessCategory(id) {
            for (const [cat, keywords] of Object.entries(CATEGORY_KEYWORDS)) {
                if (keywords.some(kw => id.includes(kw))) return cat;
            }
            return 'symbols';
        }

        function renderIcons() {
            const grouped = {};
            CATEGORIES.forEach(c => grouped[c.id] = []);
            icons.forEach((icon, idx) => {
                if (grouped[icon.category]) {
                    grouped[icon.category].push({ ...icon, idx });
                }
            });

            const existingCount = icons.filter(i => i.isExisting).length;
            const newCount = icons.filter(i => i.isNew).length;
            const updatedCount = icons.filter(i => i.isUpdated).length;

            let html = `<div style="margin: 15px 0; padding: 10px; background: #0f3460; border-radius: 8px;">
                <strong>${t('total')}: ${icons.length}</strong>
                ${existingCount > 0 ? `<span style="margin-left: 15px; color: #888;">ğŸ“¦ ${t('existing')}: ${existingCount}</span>` : ''}
                ${newCount > 0 ? `<span style="margin-left: 15px; color: #4caf50;">âœ¨ ${t('new_icon')}: ${newCount}</span>` : ''}
                ${updatedCount > 0 ? `<span style="margin-left: 15px; color: #ffa726;">ğŸ”„ ${t('updated')}: ${updatedCount}</span>` : ''}
            </div>`;

            for (const cat of CATEGORIES) {
                const catIcons = grouped[cat.id];
                if (catIcons.length === 0) continue;
                
                const catNew = catIcons.filter(i => i.isNew).length;
                const catName = currentLang === 'ja' ? `${cat.nameJa} (${cat.name})` : cat.name;
                
                html += `<div class="category-section">
                    <div class="category-title">${catName} - <span class="count">${catIcons.length}</span>
                        ${catNew > 0 ? `<span style="color:#4caf50; font-size:0.8rem; margin-left:10px;">+${catNew} new</span>` : ''}
                    </div>
                    <div class="icon-list">`;
                
                catIcons.forEach(icon => {
                    let bgColor = '#0f3460';
                    let badge = '';
                    if (icon.isNew) {
                        bgColor = '#1b5e20';
                        badge = '<span style="color:#4caf50; font-size:0.7rem;">âœ¨NEW</span>';
                    } else if (icon.isUpdated) {
                        bgColor = '#e65100';
                        badge = '<span style="color:#ffa726; font-size:0.7rem;">ğŸ”„</span>';
                    }
                    
                    const displayName = currentLang === 'ja' ? icon.nameJa : icon.name;
                    
                    html += `<div class="icon-item" style="background:${bgColor}">
                        ${icon.svgContent ? icon.svgContent.replace(/<svg/, '<svg style="width:20px;height:20px;fill:#fff"') : '<span style="color:#666">ğŸ“„</span>'}
                        <span>${displayName}</span>
                        ${badge}
                        <button class="edit-btn" onclick="openEdit(${icon.idx})">${t('btn_edit')}</button>
                        ${!icon.isExisting ? `<button class="edit-btn" style="background:#f44" onclick="removeIcon(${icon.idx})">Ã—</button>` : ''}
                    </div>`;
                });
                
                html += `</div></div>`;
            }
            
            iconsList.innerHTML = html || `<p style="color:#888">${t('no_icons')}</p>`;
        }

        function removeIcon(idx) {
            icons.splice(idx, 1);
            renderIcons();
        }

        function openEdit(idx) {
            editingIndex = idx;
            const icon = icons[idx];
            document.getElementById('editId').value = icon.id;
            document.getElementById('editName').value = icon.name;
            document.getElementById('editNameJa').value = icon.nameJa;
            document.getElementById('editCategory').value = icon.category;
            document.getElementById('editModal').classList.add('show');
        }

        function closeModal() {
            document.getElementById('editModal').classList.remove('show');
            editingIndex = -1;
        }

        function saveEdit() {
            if (editingIndex < 0) return;
            const icon = icons[editingIndex];
            icon.id = document.getElementById('editId').value;
            icon.name = document.getElementById('editName').value;
            icon.nameJa = document.getElementById('editNameJa').value;
            const newCat = document.getElementById('editCategory').value;
            icon.file = icon.file.replace(/^[^/]+/, newCat);
            icon.category = newCat;
            closeModal();
            renderIcons();
        }

        generateBtn.addEventListener('click', () => {
            const data = {
                categories: CATEGORIES,
                icons: icons.map(({ id, name, nameJa, category, file }) => ({
                    id, name, nameJa, category, file
                }))
            };
            
            const json = JSON.stringify(data, null, 2);
            const blob = new Blob([json], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = 'icons.json';
            a.click();
            
            URL.revokeObjectURL(url);
            
            alert(t('alert_generated').replace('%count%', icons.length));
        });

        // Initialize
        updateLanguage();
    </script>
</body>
</html>
